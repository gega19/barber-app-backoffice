{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/macbook/Desktop/projects/barber-application/barber-app-backoffice/lib/api.ts"],"sourcesContent":["import axios from 'axios';\nimport Cookies from 'js-cookie';\n\nconst api = axios.create({\n  baseURL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000/api',\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// Helper to create FormData requests\nexport const createFormDataRequest = (config: any) => {\n  const token = typeof window !== 'undefined' ? document.cookie.split('; ').find(row => row.startsWith('token='))?.split('=')[1] : null;\n  if (token) {\n    config.headers = {\n      ...config.headers,\n      Authorization: `Bearer ${token}`,\n    };\n  }\n  // Remove Content-Type to let browser set it with boundary\n  delete config.headers['Content-Type'];\n  return config;\n};\n\n// Interceptor para agregar token\napi.interceptors.request.use((config) => {\n  const token = Cookies.get('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\n// Interceptor para manejar errores\napi.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    if (error.response?.status === 401) {\n      // Token expirado o inválido\n      Cookies.remove('token');\n      Cookies.remove('refreshToken');\n      if (typeof window !== 'undefined') {\n        window.location.href = '/login';\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n\nexport default api;\n\n"],"names":[],"mappings":";;;;;;AAIW;AAJX;AACA;;;AAEA,MAAM,MAAM,kOAAK,CAAC,MAAM,CAAC;IACvB,SAAS,0PAAO,CAAC,GAAG,CAAC,mBAAmB,IAAI;IAC5C,SAAS;QACP,gBAAgB;IAClB;AACF;AAGO,MAAM,wBAAwB,CAAC;IACpC,MAAM,QAAQ,uCAAgC,SAAS,MAAM,CAAC,KAAK,CAAC,MAAM,IAAI,CAAC,CAAA,MAAO,IAAI,UAAU,CAAC,YAAY,MAAM,IAAI,CAAC,EAAE,GAAG;IACjI,IAAI,OAAO;QACT,OAAO,OAAO,GAAG;YACf,GAAG,OAAO,OAAO;YACjB,eAAe,CAAC,OAAO,EAAE,OAAO;QAClC;IACF;IACA,0DAA0D;IAC1D,OAAO,OAAO,OAAO,CAAC,eAAe;IACrC,OAAO;AACT;AAEA,iCAAiC;AACjC,IAAI,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IAC5B,MAAM,QAAQ,kPAAO,CAAC,GAAG,CAAC;IAC1B,IAAI,OAAO;QACT,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;IAClD;IACA,OAAO;AACT;AAEA,mCAAmC;AACnC,IAAI,YAAY,CAAC,QAAQ,CAAC,GAAG,CAC3B,CAAC,WAAa,UACd,CAAC;IACC,IAAI,MAAM,QAAQ,EAAE,WAAW,KAAK;QAClC,4BAA4B;QAC5B,kPAAO,CAAC,MAAM,CAAC;QACf,kPAAO,CAAC,MAAM,CAAC;QACf,wCAAmC;YACjC,OAAO,QAAQ,CAAC,IAAI,GAAG;QACzB;IACF;IACA,OAAO,QAAQ,MAAM,CAAC;AACxB;uCAGa","debugId":null}},
    {"offset": {"line": 61, "column": 0}, "map": {"version":3,"sources":["file:///Users/macbook/Desktop/projects/barber-application/barber-app-backoffice/lib/auth.ts"],"sourcesContent":["import api from './api';\nimport Cookies from 'js-cookie';\n\nexport interface LoginCredentials {\n  email: string;\n  password: string;\n}\n\nexport type UserRole = 'ADMIN' | 'CLIENT' | 'USER';\n\nexport interface AuthResponse {\n  user: {\n    id: string;\n    email: string;\n    name: string;\n    role: UserRole;\n  };\n  token: string;\n  refreshToken: string;\n}\n\n// Roles permitidos para acceder al backoffice\nconst ALLOWED_BACKOFFICE_ROLES: UserRole[] = ['ADMIN', 'CLIENT'];\n\nexport const authService = {\n  async login(credentials: LoginCredentials): Promise<AuthResponse> {\n    try {\n      const response = await api.post<{ success: boolean; data: AuthResponse }>('/auth/login', credentials);\n      \n      if (response.data.success && response.data.data) {\n        const data = response.data.data;\n        \n        // El backend devuelve accessToken, no token - mapear correctamente\n        const token = (data as any).accessToken || data.token;\n        const refreshToken = data.refreshToken;\n        const user = data.user;\n        \n        // Validar que todos los campos necesarios estén presentes\n        if (!token || !refreshToken || !user) {\n          throw new Error('Respuesta del servidor incompleta. Faltan datos de autenticación.');\n        }\n        \n        // Guardar tokens en cookies\n        Cookies.set('token', token, { expires: 7 }); // 7 días\n        Cookies.set('refreshToken', refreshToken, { expires: 7 });\n        \n        // Retornar con la estructura correcta\n        return {\n          token,\n          refreshToken,\n          user,\n        };\n      }\n      \n      throw new Error('Login failed: respuesta del servidor inválida');\n    } catch (error: any) {\n      if (error.response) {\n        throw new Error(error.response.data?.message || 'Error al iniciar sesión');\n      }\n      throw error;\n    }\n  },\n\n  async logout(): Promise<void> {\n    try {\n      await api.post('/auth/logout');\n    } catch (error) {\n      // Silently fail on logout\n    } finally {\n      Cookies.remove('token');\n      Cookies.remove('refreshToken');\n    }\n  },\n\n  async getCurrentUser() {\n    const response = await api.get<{ success: boolean; data: any }>('/auth/me');\n    return response.data.data;\n  },\n\n  isAuthenticated(): boolean {\n    return !!Cookies.get('token');\n  },\n\n  canAccessBackoffice(role?: UserRole): boolean {\n    if (!role) {\n      // Intentar obtener el role del token si está disponible\n      const token = Cookies.get('token');\n      if (!token) return false;\n      \n      try {\n        // Decodificar el token para obtener el role\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        role = (payload.role as string)?.toUpperCase() as UserRole;\n      } catch {\n        return false;\n      }\n    }\n    \n    // Normalizar el role a mayúsculas para comparación\n    const normalizedRole = role.toUpperCase() as UserRole;\n    \n    // Verificar que el role esté en la lista de roles permitidos\n    return ALLOWED_BACKOFFICE_ROLES.some(allowedRole => \n      allowedRole.toUpperCase() === normalizedRole\n    );\n  },\n\n  getCurrentRole(): UserRole | null {\n    const token = Cookies.get('token');\n    if (!token) return null;\n    \n    try {\n      const payload = JSON.parse(atob(token.split('.')[1]));\n      const role = payload.role as string;\n      if (!role) return null;\n      \n      // Normalizar a mayúsculas y validar que sea un role válido\n      const normalizedRole = role.toUpperCase();\n      if (['ADMIN', 'CLIENT', 'USER'].includes(normalizedRole)) {\n        return normalizedRole as UserRole;\n      }\n      \n      return null;\n    } catch {\n      return null;\n    }\n  },\n};\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAoBA,8CAA8C;AAC9C,MAAM,2BAAuC;IAAC;IAAS;CAAS;AAEzD,MAAM,cAAc;IACzB,MAAM,OAAM,WAA6B;QACvC,IAAI;YACF,MAAM,WAAW,MAAM,uMAAG,CAAC,IAAI,CAA2C,eAAe;YAEzF,IAAI,SAAS,IAAI,CAAC,OAAO,IAAI,SAAS,IAAI,CAAC,IAAI,EAAE;gBAC/C,MAAM,OAAO,SAAS,IAAI,CAAC,IAAI;gBAE/B,mEAAmE;gBACnE,MAAM,QAAQ,AAAC,KAAa,WAAW,IAAI,KAAK,KAAK;gBACrD,MAAM,eAAe,KAAK,YAAY;gBACtC,MAAM,OAAO,KAAK,IAAI;gBAEtB,0DAA0D;gBAC1D,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,MAAM;oBACpC,MAAM,IAAI,MAAM;gBAClB;gBAEA,4BAA4B;gBAC5B,kPAAO,CAAC,GAAG,CAAC,SAAS,OAAO;oBAAE,SAAS;gBAAE,IAAI,SAAS;gBACtD,kPAAO,CAAC,GAAG,CAAC,gBAAgB,cAAc;oBAAE,SAAS;gBAAE;gBAEvD,sCAAsC;gBACtC,OAAO;oBACL;oBACA;oBACA;gBACF;YACF;YAEA,MAAM,IAAI,MAAM;QAClB,EAAE,OAAO,OAAY;YACnB,IAAI,MAAM,QAAQ,EAAE;gBAClB,MAAM,IAAI,MAAM,MAAM,QAAQ,CAAC,IAAI,EAAE,WAAW;YAClD;YACA,MAAM;QACR;IACF;IAEA,MAAM;QACJ,IAAI;YACF,MAAM,uMAAG,CAAC,IAAI,CAAC;QACjB,EAAE,OAAO,OAAO;QACd,0BAA0B;QAC5B,SAAU;YACR,kPAAO,CAAC,MAAM,CAAC;YACf,kPAAO,CAAC,MAAM,CAAC;QACjB;IACF;IAEA,MAAM;QACJ,MAAM,WAAW,MAAM,uMAAG,CAAC,GAAG,CAAkC;QAChE,OAAO,SAAS,IAAI,CAAC,IAAI;IAC3B;IAEA;QACE,OAAO,CAAC,CAAC,kPAAO,CAAC,GAAG,CAAC;IACvB;IAEA,qBAAoB,IAAe;QACjC,IAAI,CAAC,MAAM;YACT,wDAAwD;YACxD,MAAM,QAAQ,kPAAO,CAAC,GAAG,CAAC;YAC1B,IAAI,CAAC,OAAO,OAAO;YAEnB,IAAI;gBACF,4CAA4C;gBAC5C,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;gBACnD,OAAQ,QAAQ,IAAI,EAAa;YACnC,EAAE,OAAM;gBACN,OAAO;YACT;QACF;QAEA,mDAAmD;QACnD,MAAM,iBAAiB,KAAK,WAAW;QAEvC,6DAA6D;QAC7D,OAAO,yBAAyB,IAAI,CAAC,CAAA,cACnC,YAAY,WAAW,OAAO;IAElC;IAEA;QACE,MAAM,QAAQ,kPAAO,CAAC,GAAG,CAAC;QAC1B,IAAI,CAAC,OAAO,OAAO;QAEnB,IAAI;YACF,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;YACnD,MAAM,OAAO,QAAQ,IAAI;YACzB,IAAI,CAAC,MAAM,OAAO;YAElB,2DAA2D;YAC3D,MAAM,iBAAiB,KAAK,WAAW;YACvC,IAAI;gBAAC;gBAAS;gBAAU;aAAO,CAAC,QAAQ,CAAC,iBAAiB;gBACxD,OAAO;YACT;YAEA,OAAO;QACT,EAAE,OAAM;YACN,OAAO;QACT;IACF;AACF","debugId":null}},
    {"offset": {"line": 174, "column": 0}, "map": {"version":3,"sources":["file:///Users/macbook/Desktop/projects/barber-application/barber-app-backoffice/app/page.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { authService } from '@/lib/auth';\n\nexport default function Home() {\n  const router = useRouter();\n\n  useEffect(() => {\n    // Verificar si está autenticado y tiene permisos\n    if (authService.isAuthenticated() && authService.canAccessBackoffice()) {\n      router.push('/dashboard');\n    } else {\n      router.push('/login');\n    }\n  }, [router]);\n\n  return (\n    <div className=\"flex items-center justify-center min-h-screen\">\n      <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600\"></div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;;;AAJA;;;;AAMe,SAAS;;IACtB,MAAM,SAAS,IAAA,iOAAS;IAExB,IAAA,yPAAS;0BAAC;YACR,iDAAiD;YACjD,IAAI,4MAAW,CAAC,eAAe,MAAM,4MAAW,CAAC,mBAAmB,IAAI;gBACtE,OAAO,IAAI,CAAC;YACd,OAAO;gBACL,OAAO,IAAI,CAAC;YACd;QACF;yBAAG;QAAC;KAAO;IAEX,qBACE,4QAAC;QAAI,WAAU;kBACb,cAAA,4QAAC;YAAI,WAAU;;;;;;;;;;;AAGrB;GAjBwB;;QACP,iOAAS;;;KADF","debugId":null}}]
}