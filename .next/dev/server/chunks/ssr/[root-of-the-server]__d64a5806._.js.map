{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 112, "column": 0}, "map": {"version":3,"sources":["file:///Users/macbook/Desktop/projects/barber-application/barber-app-backoffice/lib/api.ts"],"sourcesContent":["import axios from 'axios';\nimport Cookies from 'js-cookie';\n\nconst api = axios.create({\n  baseURL: process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3000/api',\n  headers: {\n    'Content-Type': 'application/json',\n  },\n});\n\n// Helper to create FormData requests\nexport const createFormDataRequest = (config: any) => {\n  const token = typeof window !== 'undefined' ? document.cookie.split('; ').find(row => row.startsWith('token='))?.split('=')[1] : null;\n  if (token) {\n    config.headers = {\n      ...config.headers,\n      Authorization: `Bearer ${token}`,\n    };\n  }\n  // Remove Content-Type to let browser set it with boundary\n  delete config.headers['Content-Type'];\n  return config;\n};\n\n// Interceptor para agregar token\napi.interceptors.request.use((config) => {\n  const token = Cookies.get('token');\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`;\n  }\n  return config;\n});\n\n// Interceptor para manejar errores\napi.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    if (error.response?.status === 401) {\n      // Token expirado o inválido\n      Cookies.remove('token');\n      Cookies.remove('refreshToken');\n      if (typeof window !== 'undefined') {\n        window.location.href = '/login';\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n\nexport default api;\n\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,MAAM,+NAAK,CAAC,MAAM,CAAC;IACvB,SAAS,QAAQ,GAAG,CAAC,mBAAmB,IAAI;IAC5C,SAAS;QACP,gBAAgB;IAClB;AACF;AAGO,MAAM,wBAAwB,CAAC;IACpC,MAAM,QAAQ,sCAAgC,0BAAmF;IACjI;;IAMA,0DAA0D;IAC1D,OAAO,OAAO,OAAO,CAAC,eAAe;IACrC,OAAO;AACT;AAEA,iCAAiC;AACjC,IAAI,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IAC5B,MAAM,QAAQ,+OAAO,CAAC,GAAG,CAAC;IAC1B,IAAI,OAAO;QACT,OAAO,OAAO,CAAC,aAAa,GAAG,CAAC,OAAO,EAAE,OAAO;IAClD;IACA,OAAO;AACT;AAEA,mCAAmC;AACnC,IAAI,YAAY,CAAC,QAAQ,CAAC,GAAG,CAC3B,CAAC,WAAa,UACd,CAAC;IACC,IAAI,MAAM,QAAQ,EAAE,WAAW,KAAK;QAClC,4BAA4B;QAC5B,+OAAO,CAAC,MAAM,CAAC;QACf,+OAAO,CAAC,MAAM,CAAC;QACf;;IAGF;IACA,OAAO,QAAQ,MAAM,CAAC;AACxB;uCAGa","debugId":null}},
    {"offset": {"line": 160, "column": 0}, "map": {"version":3,"sources":["file:///Users/macbook/Desktop/projects/barber-application/barber-app-backoffice/lib/auth.ts"],"sourcesContent":["import api from './api';\nimport Cookies from 'js-cookie';\n\nexport interface LoginCredentials {\n  email: string;\n  password: string;\n}\n\nexport type UserRole = 'ADMIN' | 'CLIENT' | 'USER';\n\nexport interface AuthResponse {\n  user: {\n    id: string;\n    email: string;\n    name: string;\n    role: UserRole;\n  };\n  token: string;\n  refreshToken: string;\n}\n\n// Roles permitidos para acceder al backoffice\nconst ALLOWED_BACKOFFICE_ROLES: UserRole[] = ['ADMIN', 'CLIENT'];\n\nexport const authService = {\n  async login(credentials: LoginCredentials): Promise<AuthResponse> {\n    try {\n      const response = await api.post<{ success: boolean; data: AuthResponse }>('/auth/login', credentials);\n      \n      if (response.data.success && response.data.data) {\n        const data = response.data.data;\n        \n        // El backend devuelve accessToken, no token - mapear correctamente\n        const token = (data as any).accessToken || data.token;\n        const refreshToken = data.refreshToken;\n        const user = data.user;\n        \n        // Validar que todos los campos necesarios estén presentes\n        if (!token || !refreshToken || !user) {\n          throw new Error('Respuesta del servidor incompleta. Faltan datos de autenticación.');\n        }\n        \n        // Guardar tokens en cookies\n        Cookies.set('token', token, { expires: 7 }); // 7 días\n        Cookies.set('refreshToken', refreshToken, { expires: 7 });\n        \n        // Retornar con la estructura correcta\n        return {\n          token,\n          refreshToken,\n          user,\n        };\n      }\n      \n      throw new Error('Login failed: respuesta del servidor inválida');\n    } catch (error: any) {\n      if (error.response) {\n        throw new Error(error.response.data?.message || 'Error al iniciar sesión');\n      }\n      throw error;\n    }\n  },\n\n  async logout(): Promise<void> {\n    try {\n      await api.post('/auth/logout');\n    } catch (error) {\n      // Silently fail on logout\n    } finally {\n      Cookies.remove('token');\n      Cookies.remove('refreshToken');\n    }\n  },\n\n  async getCurrentUser() {\n    const response = await api.get<{ success: boolean; data: any }>('/auth/me');\n    return response.data.data;\n  },\n\n  isAuthenticated(): boolean {\n    return !!Cookies.get('token');\n  },\n\n  canAccessBackoffice(role?: UserRole): boolean {\n    if (!role) {\n      // Intentar obtener el role del token si está disponible\n      const token = Cookies.get('token');\n      if (!token) return false;\n      \n      try {\n        // Decodificar el token para obtener el role\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        role = (payload.role as string)?.toUpperCase() as UserRole;\n      } catch {\n        return false;\n      }\n    }\n    \n    // Normalizar el role a mayúsculas para comparación\n    const normalizedRole = role.toUpperCase() as UserRole;\n    \n    // Verificar que el role esté en la lista de roles permitidos\n    return ALLOWED_BACKOFFICE_ROLES.some(allowedRole => \n      allowedRole.toUpperCase() === normalizedRole\n    );\n  },\n\n  getCurrentRole(): UserRole | null {\n    const token = Cookies.get('token');\n    if (!token) return null;\n    \n    try {\n      const payload = JSON.parse(atob(token.split('.')[1]));\n      const role = payload.role as string;\n      if (!role) return null;\n      \n      // Normalizar a mayúsculas y validar que sea un role válido\n      const normalizedRole = role.toUpperCase();\n      if (['ADMIN', 'CLIENT', 'USER'].includes(normalizedRole)) {\n        return normalizedRole as UserRole;\n      }\n      \n      return null;\n    } catch {\n      return null;\n    }\n  },\n};\n\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAoBA,8CAA8C;AAC9C,MAAM,2BAAuC;IAAC;IAAS;CAAS;AAEzD,MAAM,cAAc;IACzB,MAAM,OAAM,WAA6B;QACvC,IAAI;YACF,MAAM,WAAW,MAAM,oMAAG,CAAC,IAAI,CAA2C,eAAe;YAEzF,IAAI,SAAS,IAAI,CAAC,OAAO,IAAI,SAAS,IAAI,CAAC,IAAI,EAAE;gBAC/C,MAAM,OAAO,SAAS,IAAI,CAAC,IAAI;gBAE/B,mEAAmE;gBACnE,MAAM,QAAQ,AAAC,KAAa,WAAW,IAAI,KAAK,KAAK;gBACrD,MAAM,eAAe,KAAK,YAAY;gBACtC,MAAM,OAAO,KAAK,IAAI;gBAEtB,0DAA0D;gBAC1D,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,MAAM;oBACpC,MAAM,IAAI,MAAM;gBAClB;gBAEA,4BAA4B;gBAC5B,+OAAO,CAAC,GAAG,CAAC,SAAS,OAAO;oBAAE,SAAS;gBAAE,IAAI,SAAS;gBACtD,+OAAO,CAAC,GAAG,CAAC,gBAAgB,cAAc;oBAAE,SAAS;gBAAE;gBAEvD,sCAAsC;gBACtC,OAAO;oBACL;oBACA;oBACA;gBACF;YACF;YAEA,MAAM,IAAI,MAAM;QAClB,EAAE,OAAO,OAAY;YACnB,IAAI,MAAM,QAAQ,EAAE;gBAClB,MAAM,IAAI,MAAM,MAAM,QAAQ,CAAC,IAAI,EAAE,WAAW;YAClD;YACA,MAAM;QACR;IACF;IAEA,MAAM;QACJ,IAAI;YACF,MAAM,oMAAG,CAAC,IAAI,CAAC;QACjB,EAAE,OAAO,OAAO;QACd,0BAA0B;QAC5B,SAAU;YACR,+OAAO,CAAC,MAAM,CAAC;YACf,+OAAO,CAAC,MAAM,CAAC;QACjB;IACF;IAEA,MAAM;QACJ,MAAM,WAAW,MAAM,oMAAG,CAAC,GAAG,CAAkC;QAChE,OAAO,SAAS,IAAI,CAAC,IAAI;IAC3B;IAEA;QACE,OAAO,CAAC,CAAC,+OAAO,CAAC,GAAG,CAAC;IACvB;IAEA,qBAAoB,IAAe;QACjC,IAAI,CAAC,MAAM;YACT,wDAAwD;YACxD,MAAM,QAAQ,+OAAO,CAAC,GAAG,CAAC;YAC1B,IAAI,CAAC,OAAO,OAAO;YAEnB,IAAI;gBACF,4CAA4C;gBAC5C,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;gBACnD,OAAQ,QAAQ,IAAI,EAAa;YACnC,EAAE,OAAM;gBACN,OAAO;YACT;QACF;QAEA,mDAAmD;QACnD,MAAM,iBAAiB,KAAK,WAAW;QAEvC,6DAA6D;QAC7D,OAAO,yBAAyB,IAAI,CAAC,CAAA,cACnC,YAAY,WAAW,OAAO;IAElC;IAEA;QACE,MAAM,QAAQ,+OAAO,CAAC,GAAG,CAAC;QAC1B,IAAI,CAAC,OAAO,OAAO;QAEnB,IAAI;YACF,MAAM,UAAU,KAAK,KAAK,CAAC,KAAK,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;YACnD,MAAM,OAAO,QAAQ,IAAI;YACzB,IAAI,CAAC,MAAM,OAAO;YAElB,2DAA2D;YAC3D,MAAM,iBAAiB,KAAK,WAAW;YACvC,IAAI;gBAAC;gBAAS;gBAAU;aAAO,CAAC,QAAQ,CAAC,iBAAiB;gBACxD,OAAO;YACT;YAEA,OAAO;QACT,EAAE,OAAM;YACN,OAAO;QACT;IACF;AACF","debugId":null}},
    {"offset": {"line": 270, "column": 0}, "map": {"version":3,"sources":["file:///Users/macbook/Desktop/projects/barber-application/barber-app-backoffice/app/login/page.tsx"],"sourcesContent":["'use client';\n\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { authService, LoginCredentials, UserRole } from '@/lib/auth';\nimport { useForm } from 'react-hook-form';\nimport { zodResolver } from '@hookform/resolvers/zod';\nimport { z } from 'zod';\nimport { LogIn, Loader2 } from 'lucide-react';\nimport Cookies from 'js-cookie';\n\nconst loginSchema = z.object({\n  email: z.string().email('Email inválido'),\n  password: z.string().min(6, 'La contraseña debe tener al menos 6 caracteres'),\n});\n\nexport default function LoginPage() {\n  const router = useRouter();\n  const [error, setError] = useState<string | null>(null);\n  const [isLoading, setIsLoading] = useState(false);\n\n  const {\n    register,\n    handleSubmit,\n    formState: { errors },\n  } = useForm<LoginCredentials>({\n    resolver: zodResolver(loginSchema),\n  });\n\n  const onSubmit = async (data: LoginCredentials) => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const response = await authService.login(data);\n      \n      // Validar que la respuesta tenga la estructura esperada\n      if (!response || !response.user || !response.token) {\n        throw new Error('Respuesta del servidor inválida. Falta información del usuario o token.');\n      }\n      \n      // Verificar si el usuario tiene permisos para acceder al backoffice\n      // Normalizar el role a mayúsculas para la comparación\n      const userRole = (response.user.role as string)?.toUpperCase() as UserRole;\n      \n      if (!authService.canAccessBackoffice(userRole)) {\n        await authService.logout();\n        setError(`No tienes permisos para acceder al panel de administración.`);\n        return;\n      }\n      \n      // Esperar un momento para asegurar que las cookies se guarden\n      await new Promise(resolve => setTimeout(resolve, 100));\n      \n      router.push('/dashboard');\n      router.refresh();\n    } catch (err: any) {\n      setError(err.response?.data?.message || err.message || 'Error al iniciar sesión');\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"bg-white rounded-2xl shadow-xl p-8\">\n          {/* Header */}\n          <div className=\"text-center mb-8\">\n            <div className=\"inline-flex items-center justify-center w-16 h-16 bg-indigo-600 rounded-full mb-4\">\n              <LogIn className=\"w-8 h-8 text-white\" />\n            </div>\n            <h1 className=\"text-3xl font-bold text-gray-900\">Barber App</h1>\n            <p className=\"text-gray-600 mt-2\">Panel de Administración</p>\n          </div>\n\n          {/* Form */}\n          <form onSubmit={handleSubmit(onSubmit)} className=\"space-y-6\">\n            {error && (\n              <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg\">\n                {error}\n              </div>\n            )}\n\n            <div>\n              <label htmlFor=\"email\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Email\n              </label>\n              <input\n                {...register('email')}\n                type=\"email\"\n                id=\"email\"\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition\"\n                placeholder=\"admin@barberapp.com\"\n              />\n              {errors.email && (\n                <p className=\"mt-1 text-sm text-red-600\">{errors.email.message}</p>\n              )}\n            </div>\n\n            <div>\n              <label htmlFor=\"password\" className=\"block text-sm font-medium text-gray-700 mb-2\">\n                Contraseña\n              </label>\n              <input\n                {...register('password')}\n                type=\"password\"\n                id=\"password\"\n                className=\"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition\"\n                placeholder=\"••••••••\"\n              />\n              {errors.password && (\n                <p className=\"mt-1 text-sm text-red-600\">{errors.password.message}</p>\n              )}\n            </div>\n\n            <button\n              type=\"submit\"\n              disabled={isLoading}\n              className=\"w-full bg-indigo-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition flex items-center justify-center gap-2\"\n            >\n              {isLoading ? (\n                <>\n                  <Loader2 className=\"w-5 h-5 animate-spin\" />\n                  Iniciando sesión...\n                </>\n              ) : (\n                <>\n                  <LogIn className=\"w-5 h-5\" />\n                  Iniciar Sesión\n                </>\n              )}\n            </button>\n          </form>\n        </div>\n\n        {/* Footer */}\n        <p className=\"text-center text-sm text-gray-600 mt-6\">\n          © 2024 Barber App. Todos los derechos reservados.\n        </p>\n      </div>\n    </div>\n  );\n}\n\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AARA;;;;;;;;;AAWA,MAAM,cAAc,iQAAC,CAAC,MAAM,CAAC;IAC3B,OAAO,iQAAC,CAAC,MAAM,GAAG,KAAK,CAAC;IACxB,UAAU,iQAAC,CAAC,MAAM,GAAG,GAAG,CAAC,GAAG;AAC9B;AAEe,SAAS;IACtB,MAAM,SAAS,IAAA,8NAAS;IACxB,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,gSAAQ,EAAgB;IAClD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gSAAQ,EAAC;IAE3C,MAAM,EACJ,QAAQ,EACR,YAAY,EACZ,WAAW,EAAE,MAAM,EAAE,EACtB,GAAG,IAAA,wPAAO,EAAmB;QAC5B,UAAU,IAAA,4PAAW,EAAC;IACxB;IAEA,MAAM,WAAW,OAAO;QACtB,aAAa;QACb,SAAS;QAET,IAAI;YACF,MAAM,WAAW,MAAM,yMAAW,CAAC,KAAK,CAAC;YAEzC,wDAAwD;YACxD,IAAI,CAAC,YAAY,CAAC,SAAS,IAAI,IAAI,CAAC,SAAS,KAAK,EAAE;gBAClD,MAAM,IAAI,MAAM;YAClB;YAEA,oEAAoE;YACpE,sDAAsD;YACtD,MAAM,WAAY,SAAS,IAAI,CAAC,IAAI,EAAa;YAEjD,IAAI,CAAC,yMAAW,CAAC,mBAAmB,CAAC,WAAW;gBAC9C,MAAM,yMAAW,CAAC,MAAM;gBACxB,SAAS,CAAC,2DAA2D,CAAC;gBACtE;YACF;YAEA,8DAA8D;YAC9D,MAAM,IAAI,QAAQ,CAAA,UAAW,WAAW,SAAS;YAEjD,OAAO,IAAI,CAAC;YACZ,OAAO,OAAO;QAChB,EAAE,OAAO,KAAU;YACjB,SAAS,IAAI,QAAQ,EAAE,MAAM,WAAW,IAAI,OAAO,IAAI;QACzD,SAAU;YACR,aAAa;QACf;IACF;IAEA,qBACE,6TAAC;QAAI,WAAU;kBACb,cAAA,6TAAC;YAAI,WAAU;;8BACb,6TAAC;oBAAI,WAAU;;sCAEb,6TAAC;4BAAI,WAAU;;8CACb,6TAAC;oCAAI,WAAU;8CACb,cAAA,6TAAC,gSAAK;wCAAC,WAAU;;;;;;;;;;;8CAEnB,6TAAC;oCAAG,WAAU;8CAAmC;;;;;;8CACjD,6TAAC;oCAAE,WAAU;8CAAqB;;;;;;;;;;;;sCAIpC,6TAAC;4BAAK,UAAU,aAAa;4BAAW,WAAU;;gCAC/C,uBACC,6TAAC;oCAAI,WAAU;8CACZ;;;;;;8CAIL,6TAAC;;sDACC,6TAAC;4CAAM,SAAQ;4CAAQ,WAAU;sDAA+C;;;;;;sDAGhF,6TAAC;4CACE,GAAG,SAAS,QAAQ;4CACrB,MAAK;4CACL,IAAG;4CACH,WAAU;4CACV,aAAY;;;;;;wCAEb,OAAO,KAAK,kBACX,6TAAC;4CAAE,WAAU;sDAA6B,OAAO,KAAK,CAAC,OAAO;;;;;;;;;;;;8CAIlE,6TAAC;;sDACC,6TAAC;4CAAM,SAAQ;4CAAW,WAAU;sDAA+C;;;;;;sDAGnF,6TAAC;4CACE,GAAG,SAAS,WAAW;4CACxB,MAAK;4CACL,IAAG;4CACH,WAAU;4CACV,aAAY;;;;;;wCAEb,OAAO,QAAQ,kBACd,6TAAC;4CAAE,WAAU;sDAA6B,OAAO,QAAQ,CAAC,OAAO;;;;;;;;;;;;8CAIrE,6TAAC;oCACC,MAAK;oCACL,UAAU;oCACV,WAAU;8CAET,0BACC;;0DACE,6TAAC,2SAAO;gDAAC,WAAU;;;;;;4CAAyB;;qEAI9C;;0DACE,6TAAC,gSAAK;gDAAC,WAAU;;;;;;4CAAY;;;;;;;;;;;;;;;;;;;;8BASvC,6TAAC;oBAAE,WAAU;8BAAyC;;;;;;;;;;;;;;;;;AAM9D","debugId":null}}]
}